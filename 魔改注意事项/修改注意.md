# 注意事项

- 每次修改完毕必须用 pnpm lint来看下告警情况，修复全部告警报错再提交

## 优先修改所有相关的文字元素

如何将整个kilo的改为我自己的zyagent，最终打包后在vs code中安装后，插件主页面还显示zyagent的整个页面样式，你分析下如何做？你可以帮我修改一版本我试一下，但是必须注意：

1. 所有的数据结构的key可以不改，否则造成关联、逻辑的错误
2. 只改内容描述
3. logo图片、图标可以先不改，你给我list出来即可，我自己手动改
4. ts、js代码中的变量别改

总之，只改内容展示性质的文字，不改变代码级别的命名或者逻辑

## 进入首页的修改

1. 找到“通过和zyagent协作，完成您的任务。查看我们的 文档 了解更多信息。” -- 改为“通过和zyagent协作，高效完成您的任务！”。 另外，其他的多语言板块的这个信息也都一并改掉。
2. 欢迎页面跳转修改：，欢迎页面点击use your own API key后跳转页面做一个变更：

- 隐藏原来kilo的配置页面，KiloCode.tsx中隐藏几乎所有的代码
- 下拉框让用户选择可选的Provider，并渲染对应组件
- 输入api key后，Models直接获取对应的数据，需要触发zyagent-gateway组件的执行，否则Model下拉框无法获取内容

## 模型提供商页面修改

- webview-ui/src/components/settings/constants.ts中export const PROVIDERS是各个模型提供商的下拉框选择，可以全部隐藏，只保留需要的

## ProviderSettingsManager.ts

```
private readonly defaultProviderProfiles: ProviderProfiles = {
    currentApiConfigName: "default",
    // apiConfigs: { default: { id: this.defaultConfigId } },
    apiConfigs: {
        default: {
            id: this.defaultConfigId,
            apiProvider: "openai",
            openAiBaseUrl: "http://39.106.153.140:13082/v1",
            openAiApiKey: "sk-faEfRShoqWj6OvOZQ4IU4auU1ZLQfqLv3a2zVZj5ZA6zCO1B",
            openAiModelId: "gpt-oss-120b",
            openAiR1FormatEnabled: true,
        },
    },
    modeApiConfigs: this.defaultModeApiConfigs,
    migrations: {
        rateLimitSecondsMigrated: true, // Mark as migrated on fresh installs
        diffSettingsMigrated: true, // Mark as migrated on fresh installs
        openAiHeadersMigrated: true, // Mark as migrated on fresh installs
        consecutiveMistakeLimitMigrated: true, // Mark as migrated on fresh installs
        todoListEnabledMigrated: true, // Mark as migrated on fresh installs
    },
}
```

## Readme

需要修改，会影响到发布成插件后的主页面

## 菜单修改

- webview-ui/src/components/settings/SettingsView.tsx中修改kilo自带的菜单，const sections变量是菜单信息，可以选择隐藏或者添加
- src下的package.json中的view/title是整个对话框最上层的菜单
- context上下文菜单，默认100%自动压缩，可以改成85%自动压缩
- 对话框及下方模型名称展示修改：隐藏对话框最底下的模型显示的组件，包括点击后可选择模型的组件，隐藏，但不用删除；在对话框里的Select API configuration选择框右边，加一个内容展示，展示当前模型名称

## src下的package.json

- 需要修改各类文字，影响发布成插件的各类描述
- 所有下面的各类命令前缀都和"name": "zyagent",有关系，比如"command": "zyagent.ghost.generateSuggestions", 这里的zyagent.就是name字段
- view/title是整个对话框最上层的菜单

## 根目录下的package.json

- 修改name为zyagent

## KiloCodeAuth.tsx

- 修改欢迎页按钮跳转等逻辑
  `<ButtonLink href="http://39.106.153.140:13082/">`
  {t("kilocode:welcome.ctaButton")}
  `</ButtonLink>`

## 加入自己的模型gateway

- 拷贝openai compatible的页面，并根据需要，隐藏部分div(style={{ display: "none" })
- 设定好这个大模型gateway组件的id，去修改messages.ts（可全部隐藏，只留下自定义的gateawy）、ApiOptions.tsx等内容即可，不需要大改，只需要follow之前所有代码规则，copy即可

## 登录

- 可以完全隐藏，通过大模型平台登录，设置api key来直接调用模型能力，不需要登录了

## MCP

- 主要配置都在McpHub.ts中
- 加入默认MCP配置（全局）：const DEFAULT_GLOBAL_MCP_SERVERS， 在initializeMcpServers这个全局Global方法中获取这个配置，并写回到文件中（如果不写回，用户前端点击自动同意，回默认一个全局MCP，导致底层MCP不可用）

## 系统提示词

- custom-instructions.ts：修改底层自定义系统提示词，如DEFAULT_GLOBAL_RULES，在addCustomInstructions方法最后加入push，将系统提示词加入到所有提示词最后（可以加到最前面，看情况）

# 技术注意事项

## 打包缓存问题

- 先把src/dist目录下删掉，在删bin/下之前打过的安装包，最后修改src/package.json的版本号，pnpm install - >pnpm build

## 注意事项

- 模型选中后，最下方仍然显示Claude-xxx的模型名称，存在缓存问题
- 主页面模型显示bug：对话框先显示了默认模型名称(如：Claude Sonnet 4 20250514)，然后过了一会在显示当前模型名称，可以改为直接显示选择的模型，不需要显示默认模型名称
- Token消耗问题解决：presentAssistantMessage.ts中加入下一步是否是最终结果的判断，如果是，直接输出，否则会输出两次最终结果；在提示词中再加入
